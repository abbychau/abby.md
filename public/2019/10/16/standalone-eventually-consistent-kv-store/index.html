<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0"><link rel="manifest" href="/manifest.json">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">






  <link rel="manifest" href="/manifest.json">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.0.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.0" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="Sharing different computer parts">
<meta name="keywords" content="Programming,abbychau,blog,PHP,Rust">
<meta property="og:type" content="website">
<meta property="og:title" content="All Categories">
<meta property="og:url" content="https://blog.abby.md/categories/index.html">
<meta property="og:site_name" content="abby::blog">
<meta property="og:description" content="Sharing different computer parts">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-05-20T15:17:11.897Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="All Categories">
<meta name="twitter:description" content="Sharing different computer parts">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://blog.abby.md/categories/">



  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>


  <title>Development Story on a Standalone Eventually Consistent KV-Store | abby::blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">abby::blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Simply Technical Sharing</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-links">
          <a href="/links/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-link"></i> <br>
            
            links
          </a>
        </li>
      
        
        <li class="menu-item menu-item-projects">
          <a href="/projects/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-cube"></i> <br>
            
            projects
          </a>
        </li>
      
        
        <li class="menu-item menu-item-creations">
          <a href="/creations/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-paint-brush"></i> <br>
            
            creations
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.abby.md/2019/10/16/standalone-eventually-consistent-kv-store/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Abby Chau">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://www.gravatar.com/avatar/17623b699060c78823d7d6c95d1de7ec">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abby::blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Development Story on a Standalone Eventually Consistent KV-Store</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-16T09:10:49+09:00">2019-10-16</time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/10/16/standalone-eventually-consistent-kv-store/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/10/16/standalone-eventually-consistent-kv-store/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong>Hint: If you are looking for Key-value store for your arbitrary values. This won’t suit your case.</strong></p>
<h1 id="Story"><a href="#Story" class="headerlink" title="Story"></a>Story</h1><p>I am in development of my own social networking site. After some careful consideration, I decided to use MySQL, but in a NoSQL way, like MongoDB.</p>
<p>The reason is straight-forward as I want scalibility. </p>
<p>Of course mysql can do very good scale by setting up MGM, SQL nodes, and data nodes. However, there are some problems:</p>
<ol>
<li><p>The overhead of cluster is very high when the scale is small that we need 5 servers to serve the capacity of the data volume less than 2 servers.</p>
</li>
<li><p>Network is busy for synchronizing and query. And the speed is limited by the synchronizing speed.</p>
</li>
<li><p>MySQL cluster is based on memory which with is with Maximum capacity. </p>
</li>
</ol>
<p>There are many more points for MySQL cluster is not suitable for most of the business cases, so please search around if you are interested. This is not the core of this article.</p>
<p>Then, <strong>why not MongoDB?</strong>, because making structure can make better use of disk space and this ease the backend development too. I don’t think that NoSQL is only for unstructured data. Besides, MySQL provides JSON type as well.</p>
<h1 id="So-we-have-a-relation-problem"><a href="#So-we-have-a-relation-problem" class="headerlink" title="So we have a relation problem"></a>So we have a relation problem</h1><p>In SaaS (or whatever aaS you named) like AWS DynamoDB. AWS charges you 100bytes per item of storage to account for indexes, which is very inefficient, and thus expensive (even though it is linear). Not mentioning you need usually two or more for each function.</p>
<p>The functionality for MongoDB is limited as well. (<a href="https://www.tutorialspoint.com/mongodb/mongodb_indexing_limitations.htm" target="_blank" rel="noopener">link</a>)</p>
<p>And, MySQL will force you to do partitioning in order to continue scaling, which is not easy for business logics.</p>
<h1 id="Core-of-the-problem"><a href="#Core-of-the-problem" class="headerlink" title="Core of the problem"></a>Core of the problem</h1><p>The core of the problem is indexing.<br>Or in another word, index is prohibiting the growth of a single server because the memory of a single server is limited.</p>
<h1 id="Let’s-try-to-make-index-efficient"><a href="#Let’s-try-to-make-index-efficient" class="headerlink" title="Let’s try to make index efficient"></a>Let’s try to make index efficient</h1><p>For all of the business logic in the real world, the number is not exceeding unsigned 32bit. And even for some extreme case like “View count of Gangnam Style”, the count can be handled by 64bit.</p>
<p>unsigned 64 bit integer is even large enough for relationship counts.</p>
<p>If we assign 32GB of ram of the computer. 32GB/64bit= <code>INT_MAX of 32bit integer</code>. I would think that this is enough for storing relations for most global scale applications.</p>
<p>So in my mind, the architecture of database is just as simple as “NoSQL Store” + “Index Store”. We seperate the main problem, indexing, to another server and make the store efficient.</p>
<h1 id="Nature-of-Index"><a href="#Nature-of-Index" class="headerlink" title="Nature of Index"></a>Nature of Index</h1><p>The structure of index is very simple and fixed; which is <code>u64 -&gt; [u64;n]</code>.<br>So we usually invest too much overhead to handle arbitrary datatypes, serializations, data formating, byte-network-transport interfacings, etc.</p>
<p>My idea is to make a server taking in an integer and return a list of integer immediately.</p>
<h1 id="Journey-of-constructing-a-data-structure"><a href="#Journey-of-constructing-a-data-structure" class="headerlink" title="Journey of constructing a data-structure"></a>Journey of constructing a data-structure</h1><p>Data structure is the bread and butter of a store. </p>
<p>Let’s start with Hashmap, which is a very simple in-memory internal store. </p>
<p>Take <code>Hashmap&lt;u64, Vec&lt;u64&gt;&gt;</code> as an example.</p>
<p>…to be continued…</p>
<h1 id="Hash-Functions"><a href="#Hash-Functions" class="headerlink" title="Hash Functions"></a>Hash Functions</h1><p><a href="https://github.com/JesperAxelsson/rust-intmap" target="_blank" rel="noopener">https://github.com/JesperAxelsson/rust-intmap</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Rust/" rel="tag"># Rust</a>
          
            <a href="/tags/Database/" rel="tag"># Database</a>
          
            <a href="/tags/key-value/" rel="tag"># key-value</a>
          
            <a href="/tags/Concurrent/" rel="tag"># Concurrent</a>
          
            <a href="/tags/Development/" rel="tag"># Development</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/23/sns-pull-push/" rel="next" title="SNS Pull Mode and Push Mode">
                <i class="fa fa-chevron-left"></i> SNS Pull Mode and Push Mode
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/11/20/export-facebook-friends-id/" rel="prev" title="Export Facebook Friends list">
                Export Facebook Friends list <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://www.gravatar.com/avatar/17623b699060c78823d7d6c95d1de7ec" alt="Abby Chau">
            
              <p class="site-author-name" itemprop="name">Abby Chau</p>
              <p class="site-description motion-element" itemprop="description">Sharing different computer parts</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">32</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/abbychau" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:i@abby.md" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://soundcloud.com/abbychau" target="_blank" title="SoundCloud">
                      
                        <i class="fa fa-fw fa-soundcloud"></i>SoundCloud</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/abbychau" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.facebook.com/zkizabby" target="_blank" title="FB Page">
                      
                        <i class="fa fa-fw fa-facebook"></i>FB Page</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://youtube.com/abbychau" target="_blank" title="YouTube">
                      
                        <i class="fa fa-fw fa-youtube"></i>YouTube</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://instagram.com/abbychau2000" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i>Instagram</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.zhihu.com/people/abbychau" target="_blank" title="ZhiHu">
                      
                        <i class="fa fa-fw fa-question"></i>ZhiHu</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Story"><span class="nav-number">1.</span> <span class="nav-text">Story</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#So-we-have-a-relation-problem"><span class="nav-number">2.</span> <span class="nav-text">So we have a relation problem</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Core-of-the-problem"><span class="nav-number">3.</span> <span class="nav-text">Core of the problem</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Let’s-try-to-make-index-efficient"><span class="nav-number">4.</span> <span class="nav-text">Let’s try to make index efficient</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Nature-of-Index"><span class="nav-number">5.</span> <span class="nav-text">Nature of Index</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Journey-of-constructing-a-data-structure"><span class="nav-number">6.</span> <span class="nav-text">Journey of constructing a data-structure</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Hash-Functions"><span class="nav-number">7.</span> <span class="nav-text">Hash Functions</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Abby Chau</span>

  

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a> v6.0.0</div>



<br>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<span id="busuanzi_container_site_pv">This site is visited <span id="busuanzi_value_site_pv"></span>times.</span>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.0.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.0.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://abbychau.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://blog.abby.md/2019/10/16/standalone-eventually-consistent-kv-store/';
          this.page.identifier = '2019/10/16/standalone-eventually-consistent-kv-store/';
          this.page.title = 'Development Story on a Standalone Eventually Consistent KV-Store';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://abbychau.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  





  

  

  

  
  

  

  

  

<script>if ('serviceWorker' in navigator) {
<<<<<<< HEAD
  navigator.serviceWorker.register('/sw.js?t=1574240732448')
=======
  navigator.serviceWorker.register('/sw.js?t=1573237739526')
>>>>>>> 492e5daba96fa6d2a0ee63b469497f26f3a673dc
    .then(function () {console.log('ServiceWorker Register Successfully.')})
    .catch(function (e) {console.error(e)});
}
</script></body>
</html>
